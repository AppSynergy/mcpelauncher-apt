version: 2
jobs:
  build:
    docker:
      - image: buildpack-deps:bionic
    steps:
      - run:
          name: Update APT
          command: apt update
      - run:
          name: Install Dependencies
          command: apt install -y sudo reprepro
      - run:
          name: Checkout
          command: wget -O - https://raw.githubusercontent.com/TheBrokenRail/ftc_app/master/gh-pages/FTC-Setup.sh | bash
      - run:
          name: Build MCPELauncher
          command: ./build-mcpe.sh
      - run:
          name: Import Key
          command: openssl aes-256-cbc -d -in repo/conf/private -k ${GITHUB_TOKEN} | gpg --batch --import -
      - run:
          name: Cleanup
          command: rm repo/conf/private
      - run:
          name: Build Repo
          command: reprepro -b repo includedeb bionic mcpe-build/out/*.deb
      - run:
          name: Deploy To Github Pages
          command: ./deploy.sh
